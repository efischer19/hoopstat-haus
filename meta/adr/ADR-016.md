---
title: "ADR-016: Data Storage Architecture for Basketball Data Lakehouse"
status: "Proposed"
date: "2025-01-27"
tags:
  - "data-storage"
  - "database"
  - "architecture"
  - "data-lakehouse"
---

## Context

* **Problem:** The Hoopstat Haus project requires a comprehensive data storage strategy to handle NBA/WNBA data ingestion, processing, and analytics. As a "data lakehouse" architecture, we need to support both batch and streaming data patterns, structured and semi-structured data, and analytical workloads with high performance.
* **Constraints:** Must handle high-volume sports data ingestion, support complex analytical queries, provide cost-effective storage, integrate well with AWS infrastructure, support both real-time and batch processing, and enable data versioning and schema evolution.

## Decision

We will implement a **data lakehouse architecture using Amazon S3 as the data lake storage with AWS Glue for catalog management and Apache Iceberg for table format**, complemented by **PostgreSQL for operational data and metadata management**.

## Considered Options

1. **Data Lakehouse with S3 + Iceberg + Glue (The Chosen One):** Modern lakehouse architecture with open table formats.
   * *Pros:* Supports both batch and streaming data, ACID transactions on data lake, schema evolution, time travel queries, cost-effective storage, excellent analytics performance, vendor-neutral table format, integrates well with modern data tools
   * *Cons:* More complex initial setup, requires understanding of modern data stack, newer technology with evolving ecosystem

2. **Traditional Data Warehouse (Redshift/Snowflake):** Centralized analytical database.
   * *Pros:* Mature technology, excellent SQL support, built-in optimization, simpler architecture for analytics
   * *Cons:* Expensive for large data volumes, less flexible for semi-structured data, vendor lock-in, requires ETL preprocessing

3. **Pure Data Lake (S3 + Parquet):** Simple object storage with file formats.
   * *Pros:* Very cost-effective, simple storage model, excellent for archival
   * *Cons:* No ACID properties, difficult data management, poor query performance, no schema enforcement

4. **NoSQL + Data Lake Hybrid:** MongoDB/DynamoDB for operational data, S3 for analytics.
   * *Pros:* Flexible schema for varied sports data, good for real-time operations
   * *Cons:* Complex data synchronization, limited analytical capabilities, higher operational complexity

## Architecture Components

### Data Lake Storage (S3 + Iceberg)
- **Raw Data Zone:** Incoming sports data in original formats (JSON, CSV, XML)
- **Bronze Tables:** Minimally processed data with basic validation and partitioning
- **Silver Tables:** Cleaned, validated, and normalized data with business logic applied
- **Gold Tables:** Aggregated, business-ready datasets optimized for analytics and ML

### Operational Database (PostgreSQL)
- **Application metadata:** User accounts, API keys, system configuration
- **Job orchestration:** Pipeline execution status, scheduling information
- **Data catalog supplement:** Additional metadata not managed by Glue
- **Real-time operational data:** Recent game statistics, live scores (cached)

### Data Catalog and Governance
- **AWS Glue Data Catalog:** Schema registry and metadata management for lake tables
- **Iceberg table format:** ACID transactions, schema evolution, hidden partitioning
- **Data lineage tracking:** Dependencies and transformations between datasets

## Data Organization Strategy

### Partitioning Scheme
```
s3://hoopstat-data-lake/
├── raw/
│   ├── year=2024/month=01/day=15/hour=14/
│   └── source=nba_api/data_type=games/
├── bronze/
│   ├── games/year=2024/month=01/
│   └── players/year=2024/season=2023-24/
├── silver/
│   ├── game_stats/year=2024/month=01/
│   └── player_performance/year=2024/season=2023-24/
└── gold/
    ├── team_analytics/year=2024/
    └── player_rankings/season=2023-24/
```

### Data Retention Policy
- **Raw data:** Retain indefinitely for compliance and reprocessing
- **Bronze data:** 5 years for operational needs
- **Silver data:** 7 years for historical analysis
- **Gold data:** Retain indefinitely as business assets

## Consequences

* **Positive:** Supports both operational and analytical workloads, cost-effective storage for large datasets, ACID properties ensure data consistency, schema evolution supports changing sports data formats, excellent scalability for growing data volumes, open table format prevents vendor lock-in, time travel enables data debugging and auditing, integrates well with modern analytics and ML tools.
* **Negative:** More complex architecture requiring expertise in modern data stack, initial setup and configuration complexity, requires careful data governance and lifecycle management, multiple storage systems to maintain and monitor.
* **Future Implications:** All data ingestion pipelines must be designed for the medallion architecture (bronze/silver/gold), applications should primarily read from gold tables for performance, real-time features will use a combination of PostgreSQL cache and silver tables, data versioning and rollback capabilities enable safe schema changes, foundation supports advanced analytics and machine learning workloads.